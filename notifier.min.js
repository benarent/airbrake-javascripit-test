(function(b,a,d){function c(f){var g=(f&&f.e)?f.e:null;var i=f?!!f.guess:true;var h=new c.implementation();var e=h.run(g);return(i)?h.guessFunctions(e):e;}c.implementation=function(){};c.implementation.prototype={run:function(e){e=e||(function(){try{var g=__undef__<<1;}catch(h){return h;}})();var f=this._mode||this.mode(e);if(f==="other"){return this.other(arguments.callee);}else{return this[f](e);}},mode:function(f){if(f["arguments"]){return(this._mode="chrome");}else{if(b.opera&&f.stacktrace){return(this._mode="opera10");}else{if(f.stack){return(this._mode="firefox");}else{if(b.opera&&!("stacktrace" in f)){return(this._mode="opera");}}}}return(this._mode="other");},instrumentFunction:function(e,f,g){e=e||b;e["_old"+f]=e[f];e[f]=function(){g.call(this,c());return e["_old"+f].apply(this,arguments);};e[f]._instrumented=true;},deinstrumentFunction:function(e,f){if(e[f].constructor===Function&&e[f]._instrumented&&e["_old"+f].constructor===Function){e[f]=e["_old"+f];}},chrome:function(f){return f.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n");},firefox:function(f){return f.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");},opera10:function(m){var o=m.stacktrace;var q=o.split("\n"),f="{anonymous}",n=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i,k,h,l;for(k=2,h=0,l=q.length;k<l-2;k++){if(n.test(q[k])){var p=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2;var g=RegExp.$3;g=g.replace(/<anonymous function\:?\s?(\S+)?>/g,f);q[h++]=g+"@"+p;}}q.splice(h,q.length-h);return q;},opera:function(n){var h=n.message.split("\n"),g="{anonymous}",m=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i,l,k,f;for(l=4,k=0,f=h.length;l<f;l+=2){if(m.test(h[l])){h[k++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:g+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+h[l+1].replace(/^\s+/,"");}}h.splice(k,h.length-k);return h;},other:function(k){var f="{anonymous}",j=/function\s*([\w\-$]+)?\s*\(/i,e=[],h,g,i=10;while(k&&e.length<i){h=j.test(k.toString())?RegExp.$1||f:f;g=Array.prototype.slice.call(k["arguments"]);e[e.length]=h+"("+this.stringifyArguments(g)+")";k=k.caller;}return e;},stringifyArguments:function(f){for(var g=0;g<f.length;++g){var e=f[g];if(e===d){f[g]="undefined";}else{if(e===null){f[g]="null";}else{if(e.constructor){if(e.constructor===Array){if(e.length<3){f[g]="["+this.stringifyArguments(e)+"]";}else{f[g]="["+this.stringifyArguments(Array.prototype.slice.call(e,0,1))+"..."+this.stringifyArguments(Array.prototype.slice.call(e,-1))+"]";}}else{if(e.constructor===Object){f[g]="#object";}else{if(e.constructor===Function){f[g]="#function";}else{if(e.constructor===String){f[g]='"'+e+'"';}}}}}}}}return f.join(",");},sourceCache:{},ajax:function(e){var f=this.createXMLHTTPObject();if(!f){return;}f.open("GET",e,false);f.setRequestHeader("User-Agent","XMLHTTP/1.0");f.send("");return f.responseText;},createXMLHTTPObject:function(){var h,f=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Msxml3.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];for(var g=0;g<f.length;g++){try{h=f[g]();this.createXMLHTTPObject=f[g];return h;}catch(j){}}},isSameDomain:function(e){return e.indexOf(location.hostname)!==-1;},getSource:function(e){if(!(e in this.sourceCache)){this.sourceCache[e]=this.ajax(e).split("\n");}return this.sourceCache[e];},guessFunctions:function(f){for(var h=0;h<f.length;++h){var n=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/;var l=f[h],e=n.exec(l);if(e){var g=e[1],k=e[4];if(g&&this.isSameDomain(g)&&k){var j=this.guessFunctionName(g,k);f[h]=l.replace("{anonymous}",j);}}}return f;},guessFunctionName:function(f,h){try{return this.guessFunctionNameFromLines(h,this.getSource(f));}catch(g){return"getSource failed with url: "+f+", exception: "+g.toString();}},guessFunctionNameFromLines:function(n,k){var g=/function ([^(]*)\(([^)]*)\)/;var l=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/;var f="",h=10;for(var j=0;j<h;++j){f=k[n-j]+f;if(f!==d){var e=l.exec(f);if(e&&e[1]){return e[1];}else{e=g.exec(f);if(e&&e[1]){return e[1];}}}}return"(?)";}};(function(){var i='<?xml version="1.0" encoding="UTF-8"?><notice version="2.0"><api-key>{key}</api-key><notifier><name>airbrake_js</name><version>0.2.0</version><url>http://airbrake.io</url></notifier><error><class>{exception_class}</class><message>{exception_message}</message><backtrace>{backtrace_lines}</backtrace></error><request><url>{request_url}</url><component>{request_component}</component><action>{request_action}</action>{request}</request><server-environment><project-root>{project_root}</project-root><environment-name>{environment}</environment-name></server-environment></notice>',j="<{group_name}>{inner_content}</{group_name}>",m='<var key="{key}">{value}</var>',e='<line method="{method}" file="{file}" number="{number}" />',g,f,l,n,h={version:"2.0","api-key":"{key}",notifier:{name:"airbrake_js",version:"0.2.0",url:"http://airbrake.io"},error:{"class":"{exception_class}",message:"{exception_message}",backtrace:[]},request:{url:"{request_url}",component:"{request_component}",action:"{request_action}"},"server-environment":{"project-root":"{project_root}","environment-name":"{environment}"}};l={merge:(function(){function o(q,p,r){if(r.hasOwnProperty(q)){p[q]=r[q];}}return function(){var r=Array.prototype.slice.call(arguments),s,q,p={};while(s=r.shift()){for(q in s){o(q,p,s);}}return p;};})(),escape:function(o){return o.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");},trim:function(o){return o.toString().replace(/^\s+/,"").replace(/\s+$/,"");},substitute:function(q,p,o){return q.replace(/{([\w_.-]+)}/g,function(r,s){return(s in p)?p[s]:(o?"":r);});},substituteArr:function(t,q,s){var r=0,o=0,p="";for(r=0,o=q.length;r<o;r+=1){p+=this.substitute(t,q[r],s);}return p;},processjQueryEventHandlerWrapping:function(){if(g.options.trackJQ===true){g.jQuery_fn_on_original=g.jQuery_fn_on_original||jQuery.fn.on;jQuery.fn.on=function(){var o=Array.prototype.slice.call(arguments),p=4;while((--p>-1)&&(typeof o[p]!=="function")){}if(p===-1){return g.jQuery_fn_on_original.apply(this,arguments);}o[p]=(function(q){return function(){try{q.apply(this,arguments);}catch(r){f.captureException(r);}};})(o[p]);return g.jQuery_fn_on_original.apply(this,o);};}else{(typeof g.jQuery_fn_on_original==="function")&&(jQuery.fn.on=g.jQuery_fn_on_original);}},isjQueryPresent:function(){return(typeof jQuery==="function")&&("fn" in jQuery)&&("jquery" in jQuery.fn)&&(jQuery.fn.jquery.indexOf("1.7")===0);},capitalizeFirstLetter:function(o){return o[0].toUpperCase()+o.slice(1);},generatePublicAPI:(function(){function o(q,r,s){return function(t){s[r][q]=t;};}function p(q,r,s){return function(t){return s[r][q];};}return function(q,v){var u=0,r=null,t="",s={};for(u=0;u<q.length;u+=1){r=q[u];switch(true){case (typeof r.variable!=="undefined")&&(typeof r.methodName==="undefined"):t=l.capitalizeFirstLetter(r.variable);s["set"+t]=o(r.variable,r.namespace,v);s["get"+t]=p(r.variable,r.namespace,v);break;case (typeof r.methodName!=="undefined")&&(typeof r.method!=="undefined"):s[r.methodName]=r.method;break;default:}}return s;};}())};g={xmlData:{environment:"environment"},options:{trackJQ:false,host:"api.airbrake.io",errorDefaults:{},guessFunctionName:false,requestType:"POST",outputFormat:"XML"}};n=[{variable:"environment",namespace:"xmlData"},{variable:"key",namespace:"xmlData"},{variable:"host",namespace:"options"},{variable:"errorDefaults",namespace:"options"},{variable:"guessFunctionName",namespace:"options"},{variable:"requestType",namespace:"options"},{variable:"outputFormat",namespace:"options"},{methodName:"setTrackJQ",variable:"trackJQ",namespace:"options",method:(function(o){if(!l.isjQueryPresent()){throw Error("Please do not call 'Airbrake.setTrackJQ' if jQuery does't present");}o=!!o;if(g.options.trackJQ===o){return;}g.options.trackJQ=o;l.processjQueryEventHandlerWrapping();})},{methodName:"captureException",method:(function(o){new k().notify({message:o.message,stack:o.stack});})}];f=b.Airbrake=b.Hoptoad=l.generatePublicAPI(n,g);function k(){this.options=l.merge({},g.options);this.xmlData=l.merge(this.DEF_XML_DATA,g.xmlData);}k.prototype={constructor:k,VERSION:"0.2.0",ROOT:b.location.protocol+"//"+b.location.host,BACKTRACE_MATCHER:/^(.*)\@(.*)\:(\d+)$/,backtrace_filters:[/notifier\.js/],DEF_XML_DATA:{request:{}},notify:(function(){function p(q,s){var r=a.createElement("iframe");r.style.display="none";r.src=q+"?data="+s;r.onload=function(){setTimeout(function(){a.body.removeChild(r);},0);};a.body.appendChild(r);}function o(q,s){var r=new XMLHttpRequest();r.open("POST",q,true);r.send(s);}return function(s){var q="",r="http://"+this.options.host+"/notifier_api/v2/notices";switch(this.options.outputFormat){case"XML":q=escape(this.generateXML(this.generateDataJSON(s)));break;case"JSON":q=JSON.stringify(this.generateJSON(this.generateDataJSON(s)));break;default:}switch(this.options.requestType){case"POST":o(r,q);break;case"GET":p(r,q);break;default:}};}()),generateDataJSON:(function(){function p(q){var r="",s=[];for(r in q){if(q.hasOwnProperty(r)){s.push({key:r,value:q[r]});}}return s;}function o(q,t){var u=0,r={},s="";for(u=0;u<q.length;u+=1){s=q[u];if(typeof t[s]!=="undefined"){r[s]=p(t[s]);}}return r;}return function(r){var q=this.xmlData,v=l.merge(this.options.errorDefaults,r),u=v.component||"",t=(v.url||""+location.hash),s=["cgi-data","params","session"],w=null;w={request_url:t,request_action:(v.action||""),request_component:u,request:(function(){if(t||u){v["cgi-data"]=v["cgi-data"]||{};v["cgi-data"].HTTP_USER_AGENT=navigator.userAgent;return l.merge(q.request,o(s,v));}else{return{};}}()),project_root:this.ROOT,exception_class:(v.type||"Error"),exception_message:(v.message||"Unknown error."),backtrace_lines:this.generateBacktrace(v)};q=l.merge(q,w);return q;};}()),generateXML:(function(){function o(r){var p="",q="";for(p in r){if(r.hasOwnProperty(p)){q+=l.substitute(j,{group_name:p,inner_content:l.substituteArr(m,r[p],true)},true);}}return q;}return function(p){p.request=o(p.request);p.backtrace_lines=l.substituteArr(e,p.backtrace_lines,true);return l.substitute(i,p,true);};}()),generateJSON:function(o){var p=JSON.parse(l.substitute(JSON.stringify(h),o,true));p.request=l.merge(p.request,o.request);p.error.backtrace=o.backtrace_lines;return p;},generateBacktrace:function(p){var o=[],r,q,t,s;p=p||{};if(typeof p.stack!=="string"){try{(0)();}catch(u){p.stack=u.stack;}}s=this.getStackTrace(p);for(q=0;q<s.length;q++){t=s[q].match(this.BACKTRACE_MATCHER);if(t&&this.validBacktraceLine(s[q])){r=t[2].replace(this.ROOT,"[PROJECT_ROOT]");if(q===0&&t[2].match(a.location.href)){o.push({method:"",file:"internal: ",number:""});}o.push({method:t[1],file:r,number:t[3]});}}return o;},getStackTrace:function(o){var p,q=c({e:o,guess:this.options.guessFunctionName});for(p=0;p<q.length;p++){if(q[p].match(/\:\d+$/)){continue;}if(q[p].indexOf("@")===-1){q[p]+="@unsupported.js";}q[p]+=":0";}return q;},validBacktraceLine:function(o){for(var p=0;p<this.backtrace_filters.length;p++){if(o.match(this.backtrace_filters[p])){return false;}}return true;}};b.onerror=function(q,p,o){setTimeout(function(){new k().notify({message:q,stack:"()@"+p+":"+o});},0);return true;};})();})(window,document);